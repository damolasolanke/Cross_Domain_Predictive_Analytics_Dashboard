{% extends "base.html" %}

{% block title %}Supply Chain Optimization{% endblock %}

{% block styles %}
<style>
    :root {
        --primary-color: #2563eb;
        --primary-light: #3b82f6;
        --primary-dark: #1d4ed8;
        --secondary-color: #64748b;
        --accent-color: #10b981;
        --danger-color: #ef4444;
        --warning-color: #f59e0b;
        --info-color: #06b6d4;
        --success-color: #10b981;
        --light-bg: #f8fafc;
        --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --transition: all 0.3s ease;
    }
    
    .dashboard-container {
        max-width: 1440px;
        margin: 0 auto;
        padding: 1.5rem;
    }
    
    .hero-section {
        position: relative;
        padding: 5rem 0 3rem;
        background-color: var(--light-bg);
        border-radius: 1rem;
        overflow: hidden;
        margin-bottom: 2rem;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("{{ url_for('static', filename='img/supply-chain-bg.jpg') }}");
        background-size: cover;
        background-position: center;
        opacity: 0.15;
        z-index: 0;
    }
    
    .hero-content {
        position: relative;
        z-index: 1;
        text-align: center;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .hero-title {
        font-size: 3rem;
        font-weight: 800;
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
        letter-spacing: -0.5px;
    }
    
    .hero-subtitle {
        font-size: 1.25rem;
        font-weight: 400;
        color: var(--secondary-color);
        margin-bottom: 2rem;
        line-height: 1.6;
    }
    
    .card-modern {
        border: none;
        border-radius: 1rem;
        box-shadow: var(--card-shadow);
        transition: var(--transition);
        overflow: hidden;
        height: 100%;
    }
    
    .card-modern:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .card-header-modern {
        background-color: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 1.25rem 1.5rem;
    }
    
    .card-title-modern {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0;
        color: var(--primary-dark);
    }
    
    .insights-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .time-selector {
        background-color: white;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        font-weight: 500;
        min-width: 180px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }
</style>
{% endblock %}

{% block content %}
<!-- Add Plotly.js for interactive visualizations -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<div class="dashboard-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Supply Chain Optimization</h1>
            <p class="hero-subtitle">Leverage cross-domain analytics to predict inventory needs by combining weather forecasts, economic indicators, social media trends, and transportation metrics for proactive supply chain optimization.</p>
            <div class="d-flex justify-content-center align-items-center">
                <select id="timeRangeSelect" class="time-selector">
                                <option value="1d">Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                                <option value="90d">Last 90 Days</option>
                                <option value="180d">Last 180 Days</option>
                                <option value="365d">Last Year</option>
                            </select>
                        </div>
                    </div>
                </div>
    
    <!-- Main Dashboard Content -->
    <div class="row g-4">
        <!-- Domain-specific Cards Section -->
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fs-3 fw-bold m-0">Cross-Domain Analytics</h2>
                <span class="badge bg-primary rounded-pill px-3 py-2">Updated Just Now</span>
                                </div>
                                    </div>
        
        <!-- Weather Impact Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card-modern">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <h3 class="card-title-modern">
                        <i class="bi bi-cloud-sun me-2 text-info"></i>
                        Weather Impact
                    </h3>
                    <span class="badge bg-info rounded-pill">Live</span>
                                    </div>
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <span class="d-block text-secondary small mb-1">Current Condition</span>
                            <span class="d-block fs-3 fw-bold text-dark">{{ data.weather_forecast.condition }}</span>
                                </div>
                        <div>
                            <span class="d-block text-secondary small mb-1">Temperature</span>
                            <span class="d-block fs-2 fw-bold text-info">{{ data.weather_forecast.temperature }}°F</span>
                            </div>
                        </div>
                    <div class="alert alert-warning mt-3 d-flex align-items-center">
                        <i class="bi bi-exclamation-triangle-fill fs-5 me-2"></i>
                        <div class="small">
                            <strong>Weather Alert:</strong> Extreme conditions affecting refrigerated shipping routes.
                                </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Economic Indicators Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card-modern">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <h3 class="card-title-modern">
                        <i class="bi bi-graph-up me-2 text-success"></i>
                        Economic Indicators
                    </h3>
                    <span class="badge bg-success rounded-pill">Trending</span>
                </div>
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <span class="d-block text-secondary small mb-1">Consumer Confidence</span>
                            <span class="d-block fs-3 fw-bold text-dark">{{ data.economic_indicators.consumer_confidence }}</span>
                        </div>
                        <div>
                            <span class="d-block text-secondary small mb-1">Market Trend</span>
                            <span class="d-block fs-4 fw-bold text-success">
                                <i class="bi bi-graph-up-arrow me-1"></i>
                                            {{ data.economic_indicators.trend|capitalize }}
                            </span>
                                    </div>
                                    </div>
                    <div class="alert alert-success mt-3 d-flex align-items-center">
                        <i class="bi bi-info-circle-fill fs-5 me-2"></i>
                        <div class="small">
                            <strong>Market Insight:</strong> Higher demand for premium products expected.
                                </div>
                            </div>
                        </div>
                                </div>
        </div>
        
        <!-- Transportation Metrics Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card-modern">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <h3 class="card-title-modern">
                        <i class="bi bi-truck me-2 text-warning"></i>
                        Transportation
                    </h3>
                    <span class="badge bg-warning rounded-pill">Delays</span>
                </div>
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <span class="d-block text-secondary small mb-1">Avg. Shipping Time</span>
                            <span class="d-block fs-3 fw-bold text-dark">{{ data.logistics_data.average_shipping_time }} days</span>
                        </div>
                        <div>
                            <span class="d-block text-secondary small mb-1">Delay Impact</span>
                            <div class="progress mt-2" style="height: 10px; border-radius: 5px;">
                                            <div class="progress-bar bg-warning" role="progressbar" 
                                                 style="width: 45%;" 
                                                 aria-valuenow="45" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100">
                                            </div>
                                        </div>
                            <span class="small text-secondary mt-1 d-block">45% Affected Routes</span>
                                    </div>
                                    </div>
                    <div class="alert alert-warning mt-3 d-flex align-items-center">
                        <i class="bi bi-truck fs-5 me-2"></i>
                        <div class="small">
                            <strong>Route Alert:</strong> N-S corridor: 8.5h delays due to weather.
                                </div>
                            </div>
                        </div>
                                </div>
        </div>
        
        <!-- Social Media Trends Card -->
        <div class="col-md-6 col-lg-3">
            <div class="card-modern">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <h3 class="card-title-modern">
                        <i class="bi bi-chat-square-text me-2 text-primary"></i>
                        Social Media
                    </h3>
                    <span class="badge bg-primary rounded-pill">Active</span>
                </div>
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <span class="d-block text-secondary small mb-1">Sentiment</span>
                            <span class="d-block fs-3 fw-bold text-dark text-capitalize">{{ data.social_media_trends.sentiment }}</span>
                        </div>
                        <div>
                            <span class="d-block text-secondary small mb-1">Buzz Factor</span>
                            <div class="progress mt-2" style="height: 10px; border-radius: 5px;">
                                            <div class="progress-bar bg-primary" role="progressbar" 
                                                 style="width: {{ data.social_media_trends.buzz_factor }}%;" 
                                                 aria-valuenow="{{ data.social_media_trends.buzz_factor }}" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100">
                                            </div>
                                        </div>
                            <span class="small text-secondary mt-1 d-block">{{ data.social_media_trends.buzz_factor }}% Engagement</span>
                                    </div>
                                    </div>
                    <div class="alert alert-primary mt-3 d-flex align-items-center">
                        <i class="bi bi-chat-quote-fill fs-5 me-2"></i>
                        <div class="small">
                            <strong>Trend:</strong> Rising interest in sustainable packaging.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Cross-Domain Correlations Section -->
    <div class="col-12 mt-5">
        <div class="card-modern">
            <div class="card-header-modern d-flex justify-content-between align-items-center">
                <h3 class="card-title-modern">
                    <i class="bi bi-diagram-3 me-2 text-primary"></i>
                    Cross-Domain Correlations
                </h3>
                <button type="button" class="btn btn-sm btn-outline-primary rounded-pill px-3" id="toggleCorrelationView">
                    <i class="bi bi-grid-3x3 me-1"></i> Toggle View
                            </button>
                        </div>
            <div class="card-body p-4">
                    <div class="row">
                    <div class="col-lg-8">
                        <div id="correlationHeatmap" class="bg-light rounded border mb-3" style="height: 400px;"></div>
                        
                            <div id="correlationTable" class="mt-3" style="display: none;">
                                <div class="table-responsive">
                                <table class="table table-hover border-bottom">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="border-0">Factor 1</th>
                                            <th class="border-0">Factor 2</th>
                                            <th class="border-0">Strength</th>
                                            <th class="border-0">Correlation</th>
                                            <th class="border-0">Confidence</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in data.correlations %}
                                            <tr>
                                                <td>{{ item.factor1 }}</td>
                                                <td>{{ item.factor2 }}</td>
                                            <td><span class="badge {% if item.strength == 'strong' %}bg-danger{% elif item.strength == 'moderate' %}bg-warning{% else %}bg-info{% endif %} rounded-pill">{{ item.strength|capitalize }}</span></td>
                                                <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                        <div class="progress-bar {% if item.correlation > 0.8 %}bg-danger{% elif item.correlation > 0.7 %}bg-warning{% else %}bg-info{% endif %}" role="progressbar" 
                                                            style="width: {{ item.correlation * 100 }}%;" 
                                                            aria-valuenow="{{ item.correlation * 100 }}" 
                                                            aria-valuemin="0" 
                                                            aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                    <span class="text-dark small">{{ (item.correlation * 100)|int }}%</span>
                                                    </div>
                                                </td>
                                                <td>92%</td>
                                            </tr>
                                            {% endfor %}
                                            <tr>
                                                <td>Fuel Price Fluctuations</td>
                                                <td>Shipping Costs</td>
                                            <td><span class="badge bg-warning rounded-pill">Strong</span></td>
                                                <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                        <div class="progress-bar bg-warning" role="progressbar" 
                                                            style="width: 76%;" 
                                                            aria-valuenow="76" 
                                                            aria-valuemin="0" 
                                                            aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                    <span class="text-dark small">76%</span>
                                                    </div>
                                                </td>
                                                <td>88%</td>
                                            </tr>
                                            <tr>
                                                <td>Social Media Sentiment</td>
                                                <td>Consumer Demand Spikes</td>
                                            <td><span class="badge bg-info rounded-pill">Moderate</span></td>
                                                <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                        <div class="progress-bar bg-info" role="progressbar" 
                                                            style="width: 65%;" 
                                                            aria-valuenow="65" 
                                                            aria-valuemin="0" 
                                                            aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                    <span class="text-dark small">65%</span>
                                                    </div>
                                                </td>
                                                <td>78%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    
                    <div class="col-lg-4">
                        <div class="card h-100 border-0 bg-light">
                            <div class="card-header bg-primary text-white rounded-top">
                                <h5 class="mb-0 fw-bold">Key Insights</h5>
                                </div>
                                <div class="card-body">
                                <div class="p-3 mb-3 bg-white rounded-3 shadow-sm border-start border-5 border-danger">
                                    <h5 class="fs-6 fw-bold">Weather Impact on Distribution</h5>
                                    <p class="small mb-2">Extreme heat events show a <strong>87% correlation</strong> with increased cold storage demand, particularly affecting refrigerated goods distribution.</p>
                                        <div class="d-flex align-items-center">
                                        <span class="badge bg-danger me-2 rounded-pill">Strong Correlation</span>
                                            <small class="text-muted">Confidence: 92%</small>
                                        </div>
                                    </div>
                                    
                                <div class="p-3 mb-3 bg-white rounded-3 shadow-sm border-start border-5 border-warning">
                                    <h5 class="fs-6 fw-bold">Seasonal Events & Transportation</h5>
                                    <p class="small mb-2">Seasonal flooding patterns correlate <strong>79% with transportation delays</strong>, suggesting the need for alternative routing during predicted weather events.</p>
                                        <div class="d-flex align-items-center">
                                        <span class="badge bg-warning me-2 rounded-pill">Strong Correlation</span>
                                            <small class="text-muted">Confidence: 88%</small>
                                        </div>
                                    </div>
                                    
                                <div class="p-3 bg-white rounded-3 shadow-sm border-start border-5 border-info">
                                    <h5 class="fs-6 fw-bold">Social Media & Demand Prediction</h5>
                                    <p class="small mb-2">Social media sentiment shows <strong>65% correlation</strong> with consumer demand spikes within 3-5 days, particularly for trending product categories.</p>
                                        <div class="d-flex align-items-center">
                                        <span class="badge bg-info me-2 rounded-pill">Moderate Correlation</span>
                                            <small class="text-muted">Confidence: 78%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI-Powered Inventory Prediction -->
    <div class="col-12 mt-5">
        <div class="card-modern">
            <div class="card-header-modern d-flex justify-content-between align-items-center">
                <h3 class="card-title-modern">
                    <i class="bi bi-robot me-2 text-primary"></i>
                    AI-Powered Inventory Prediction
                </h3>
                <span class="badge bg-primary rounded-pill px-3 py-2">ML-Driven</span>
                </div>
            <div class="card-body p-4">
                <div class="alert alert-info d-flex align-items-start p-3 mb-4">
                    <i class="bi bi-lightbulb-fill fs-4 me-3 mt-1"></i>
                    <div>
                        <strong class="d-block mb-1">Cross-Domain Intelligence:</strong>
                        <span class="small">Our AI has analyzed weather forecasts, economic indicators, social media trends, and transportation metrics to generate these inventory predictions with high confidence.</span>
                            </div>
                        </div>
                
                    <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light text-secondary">
                            <tr>
                                <th class="border-0">Product</th>
                                <th class="border-0 text-center">Current Stock</th>
                                <th class="border-0 text-center">Predicted Demand</th>
                                <th class="border-0">Contributing Factors</th>
                                <th class="border-0 text-center">Confidence</th>
                                <th class="border-0 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in data.inventory_insights %}
                                <tr>
                                    <td>
                                    <div class="fw-medium">{{ item.product }}</div>
                                    <div class="small text-secondary">
                                        {% if item.product == 'Refrigerated Food Storage Containers' %}
                                            Category: Temperature Control
                                        {% elif item.product == 'Industrial Packaging Materials' %}
                                            Category: Packaging
                                        {% elif item.product == 'Temperature-Controlled Shipping Units' %}
                                            Category: Shipping
                                        {% else %}
                                            Category: General
                                        {% endif %}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span class="fw-medium">{{ item.current_stock }}</span>
                                    <span class="text-secondary small d-block">units</span>
                                </td>
                                <td class="text-center">
                                    <span class="fw-medium">{{ item.predicted_demand }}</span>
                                    <span class="text-secondary small d-block">units</span>
                                    </td>
                                    <td>
                                    {% if item.product == 'Refrigerated Food Storage Containers' %}
                                        <span class="badge bg-info me-1 mb-1">Extreme Heat</span>
                                        <span class="badge bg-success me-1 mb-1">Consumer Confidence</span>
                                    {% elif item.product == 'Industrial Packaging Materials' %}
                                        <span class="badge bg-warning me-1 mb-1">Holiday Season</span>
                                        <span class="badge bg-success me-1 mb-1">Economic Trend</span>
                                    {% elif item.product == 'Temperature-Controlled Shipping Units' %}
                                        <span class="badge bg-info me-1 mb-1">Weather Forecast</span>
                                        <span class="badge bg-danger me-1 mb-1">Shipping Delays</span>
                                    {% else %}
                                        <span class="badge bg-secondary me-1 mb-1">Regular Demand</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                            <div class="position-relative">
                                                <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                                    <span class="small fw-bold">{{ (item.confidence * 100)|int }}%</span>
                                                </div>
                                                <svg width="50" height="50" viewBox="0 0 36 36">
                                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="#E6E6E6"
                                                        stroke-width="3"
                                                        stroke-dasharray="100, 100"/>
                                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="{% if item.confidence > 0.8 %}#10b981{% elif item.confidence > 0.7 %}#0ea5e9{% else %}#f59e0b{% endif %}"
                                                        stroke-width="3"
                                                        stroke-dasharray="{{ item.confidence * 100 }}, 100"/>
                                                </svg>
                                            </div>
                                            </div>
                                        </div>
                                    </td>
                                <td class="text-center">
                                        {% if item.restock_recommendation > 0 %}
                                        <div class="d-grid">
                                            <button class="btn btn-warning btn-sm rounded-pill px-3">
                                                <i class="bi bi-box-seam me-1"></i>
                                                Restock +{{ item.restock_recommendation }}
                                            </button>
                                        </div>
                                        {% else %}
                                        <span class="badge bg-success rounded-pill px-3 py-2">Optimal</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                                <tr>
                                <td>
                                    <div class="fw-medium">Emergency Power Generators</div>
                                    <div class="small text-secondary">Category: Emergency</div>
                                </td>
                                <td class="text-center">
                                    <span class="fw-medium">120</span>
                                    <span class="text-secondary small d-block">units</span>
                                </td>
                                <td class="text-center">
                                    <span class="fw-medium">210</span>
                                    <span class="text-secondary small d-block">units</span>
                                    </td>
                                    <td>
                                    <span class="badge bg-danger me-1 mb-1">Weather Alert</span>
                                    <span class="badge bg-info me-1 mb-1">Social Media</span>
                                </td>
                                <td>
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                            <div class="position-relative">
                                                <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                                    <span class="small fw-bold">88%</span>
                                                </div>
                                                <svg width="50" height="50" viewBox="0 0 36 36">
                                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="#E6E6E6"
                                                        stroke-width="3"
                                                        stroke-dasharray="100, 100"/>
                                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="#10b981"
                                                        stroke-width="3"
                                                        stroke-dasharray="88, 100"/>
                                                </svg>
                                            </div>
                                            </div>
                                        </div>
                                    </td>
                                <td class="text-center">
                                    <div class="d-grid">
                                        <button class="btn btn-warning btn-sm rounded-pill px-3">
                                            <i class="bi bi-box-seam me-1"></i>
                                            Restock +90
                                        </button>
                                    </div>
                                    </td>
                                </tr>
                                <tr>
                                <td>
                                    <div class="fw-medium">Sustainable Packaging Solutions</div>
                                    <div class="small text-secondary">Category: Packaging</div>
                                </td>
                                <td class="text-center">
                                    <span class="fw-medium">3400</span>
                                    <span class="text-secondary small d-block">units</span>
                                </td>
                                <td class="text-center">
                                    <span class="fw-medium">4200</span>
                                    <span class="text-secondary small d-block">units</span>
                                    </td>
                                    <td>
                                    <span class="badge bg-primary me-1 mb-1">Social Media</span>
                                    <span class="badge bg-success me-1 mb-1">Consumer Trend</span>
                                </td>
                                <td>
                                    <div class="d-flex flex-column align-items-center">
                                        <div class="d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                            <div class="position-relative">
                                                <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                                    <span class="small fw-bold">76%</span>
                                                </div>
                                                <svg width="50" height="50" viewBox="0 0 36 36">
                                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="#E6E6E6"
                                                        stroke-width="3"
                                                        stroke-dasharray="100, 100"/>
                                                    <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="#0ea5e9"
                                                        stroke-width="3"
                                                        stroke-dasharray="76, 100"/>
                                                </svg>
                                            </div>
                                            </div>
                                        </div>
                                    </td>
                                <td class="text-center">
                                    <div class="d-grid">
                                        <button class="btn btn-warning btn-sm rounded-pill px-3">
                                            <i class="bi bi-box-seam me-1"></i>
                                            Restock +800
                                        </button>
                                    </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Logistics & Transportation Impact -->
    <div class="col-12 mt-5">
        <div class="card-modern">
            <div class="card-header-modern d-flex justify-content-between align-items-center">
                <h3 class="card-title-modern">
                    <i class="bi bi-truck me-2 text-primary"></i>
                    Logistics & Transportation Impact
                </h3>
                <button class="btn btn-sm btn-outline-primary rounded-pill px-3">
                    <i class="bi bi-map me-1"></i> View Route Map
                </button>
                </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    <div class="col-lg-6">
                        <h4 class="fs-5 fw-bold mb-3">Current Shipping Delays</h4>
                            <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light text-secondary">
                                    <tr>
                                        <th class="border-0">Route</th>
                                        <th class="border-0 text-center">Delay</th>
                                        <th class="border-0">Cause</th>
                                        <th class="border-0">Products</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for delay in data.logistics_data.shipping_delays %}
                                        <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-geo-alt text-secondary me-2"></i>
                                                <span>{{ delay.route }}</span>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                                {% if delay.delay_hours >= 24 %}
                                                <span class="badge bg-danger rounded-pill px-3 py-2">{{ delay.delay_hours }} hrs</span>
                                                {% elif delay.delay_hours >= 8 %}
                                                <span class="badge bg-warning rounded-pill px-3 py-2">{{ delay.delay_hours }} hrs</span>
                                                {% else %}
                                                <span class="badge bg-success rounded-pill px-3 py-2">{{ delay.delay_hours }} hrs</span>
                                                {% endif %}
                                            </td>
                                        <td>
                                            <span class="small">{{ delay.cause }}</span>
                                        </td>
                                        <td>
                                            <span class="small">{{ delay.affected_products }}</span>
                                        </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    
                    <div class="col-lg-6">
                        <h4 class="fs-5 fw-bold mb-3">Cross-Domain Recommendations</h4>
                        
                        <div class="recommendation-card p-3 mb-3 rounded-3 shadow-sm bg-white border-start border-4 border-primary">
                            <div class="d-flex">
                                <div class="recommendation-icon me-3">
                                    <i class="bi bi-lightning-charge-fill text-primary fs-3"></i>
                            </div>
                                <div>
                                    <h5 class="fs-6 fw-bold text-primary">Weather & Transportation</h5>
                                    <p class="small mb-1">Reroute refrigerated shipments through alternative corridors to avoid extreme heat zones.</p>
                                    <button class="btn btn-sm btn-outline-primary rounded-pill mt-2">Apply Change</button>
                            </div>
                            </div>
                            </div>
                        
                        <div class="recommendation-card p-3 mb-3 rounded-3 shadow-sm bg-white border-start border-4 border-success">
                            <div class="d-flex">
                                <div class="recommendation-icon me-3">
                                    <i class="bi bi-graph-up text-success fs-3"></i>
                        </div>
                                <div>
                                    <h5 class="fs-6 fw-bold text-success">Economic & Inventory</h5>
                                    <p class="small mb-1">Increase Industrial Packaging Materials allocation to Southern distribution centers based on rising consumer confidence.</p>
                                    <button class="btn btn-sm btn-outline-success rounded-pill mt-2">Apply Change</button>
                    </div>
                </div>
            </div>
                        
                        <div class="recommendation-card p-3 mb-3 rounded-3 shadow-sm bg-white border-start border-4 border-info">
                            <div class="d-flex">
                                <div class="recommendation-icon me-3">
                                    <i class="bi bi-chat-square-quote text-info fs-3"></i>
                                </div>
                                <div>
                                    <h5 class="fs-6 fw-bold text-info">Social Media & Product Stocking</h5>
                                    <p class="small mb-1">Increase sustainable packaging inventory by 20% based on social sentiment analysis.</p>
                                    <button class="btn btn-sm btn-outline-info rounded-pill mt-2">Apply Change</button>
                                </div>
        </div>
    </div>
    
                        <div class="recommendation-card p-3 rounded-3 shadow-sm bg-white border-start border-4 border-warning">
                            <div class="d-flex">
                                <div class="recommendation-icon me-3">
                                    <i class="bi bi-truck text-warning fs-3"></i>
                </div>
                                <div>
                                    <h5 class="fs-6 fw-bold text-warning">Weather & Route Planning</h5>
                                    <p class="small mb-1">Schedule preventative maintenance for refrigeration units on the North-South corridor fleet.</p>
                                    <button class="btn btn-sm btn-outline-warning rounded-pill mt-2">Apply Change</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                            </div>
                        </div>
                    </div>
                    
    <!-- What-If Scenarios Analysis -->
    <div class="col-12 mt-5 mb-5">
        <div class="card-modern">
            <div class="card-header-modern d-flex justify-content-between align-items-center">
                <h3 class="card-title-modern">
                    <i class="bi bi-lightbulb me-2 text-primary"></i>
                    AI-Powered Scenario Analysis
                </h3>
                <button class="btn btn-sm btn-primary rounded-pill px-3">
                    <i class="bi bi-plus-lg me-1"></i> Create Scenario
                </button>
            </div>
            <div class="card-body p-4">
                <div class="alert alert-info d-flex align-items-start p-3 mb-4">
                    <i class="bi bi-info-circle-fill fs-4 me-3 mt-1"></i>
                    <div>
                        <strong class="d-block mb-1">What-If Scenario Testing:</strong>
                        <span class="small">Explore the impact of various cross-domain variables on your supply chain operations to aid proactive decision-making.</span>
                    </div>
                </div>
                
                <div class="row g-4">
                        <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-info text-white p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 fw-bold">
                                        <i class="bi bi-cloud-sun me-2"></i> Weather Scenario
                                    </h5>
                                    <button class="btn btn-sm btn-light rounded-circle p-1" data-bs-toggle="tooltip" title="Run simulation">
                                        <i class="bi bi-play-fill"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-3">
                                <div class="scenario-condition p-3 bg-light rounded mb-4">
                                    <h6 class="d-flex align-items-center border-bottom pb-2 mb-3">
                                        <i class="bi bi-thermometer-sun me-2 text-info"></i>
                                        <span>If temperatures increase by 10°F</span>
                                    </h6>
                                    <ul class="list-group">
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Refrigeration Costs</span>
                                            <span class="badge bg-danger rounded-pill">+18%</span>
                                        </li>
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Cold Storage Demand</span>
                                            <span class="badge bg-danger rounded-pill">+25%</span>
                                        </li>
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Shipping Route Efficiency</span>
                                            <span class="badge bg-warning rounded-pill">-12%</span>
                                        </li>
                                    </ul>
                                </div>
                                <button class="btn btn-sm btn-outline-info w-100">View Detailed Analysis</button>
                            </div>
                        </div>
                    </div>
                    
                        <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-success text-white p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 fw-bold">
                                        <i class="bi bi-cash-coin me-2"></i> Economic Scenario
                                    </h5>
                                    <button class="btn btn-sm btn-light rounded-circle p-1" data-bs-toggle="tooltip" title="Run simulation">
                                        <i class="bi bi-play-fill"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-3">
                                <div class="scenario-condition p-3 bg-light rounded mb-4">
                                    <h6 class="d-flex align-items-center border-bottom pb-2 mb-3">
                                        <i class="bi bi-graph-up-arrow me-2 text-success"></i>
                                        <span>If consumer confidence rises 15%</span>
                                    </h6>
                                    <ul class="list-group">
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Premium Product Demand</span>
                                            <span class="badge bg-success rounded-pill">+23%</span>
                                        </li>
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Average Order Value</span>
                                            <span class="badge bg-success rounded-pill">+12%</span>
                                        </li>
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Warehouse Capacity Needed</span>
                                            <span class="badge bg-warning rounded-pill">+18%</span>
                                        </li>
                                    </ul>
                                </div>
                                <button class="btn btn-sm btn-outline-success w-100">View Detailed Analysis</button>
                            </div>
                        </div>
                    </div>
                    
                        <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-primary text-white p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0 fw-bold">
                                        <i class="bi bi-chat-text me-2"></i> Social Media Scenario
                                    </h5>
                                    <button class="btn btn-sm btn-light rounded-circle p-1" data-bs-toggle="tooltip" title="Run simulation">
                                        <i class="bi bi-play-fill"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-3">
                                <div class="scenario-condition p-3 bg-light rounded mb-4">
                                    <h6 class="d-flex align-items-center border-bottom pb-2 mb-3">
                                        <i class="bi bi-chat-square-heart me-2 text-primary"></i>
                                        <span>If sustainable packaging trends spike</span>
                                    </h6>
                                    <ul class="list-group">
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Eco-Friendly Packaging Demand</span>
                                            <span class="badge bg-danger rounded-pill">+42%</span>
                                        </li>
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Traditional Packaging Demand</span>
                                            <span class="badge bg-info rounded-pill">-15%</span>
                                        </li>
                                        <li class="list-group-item border-0 bg-transparent d-flex justify-content-between align-items-center px-0 py-2">
                                            <span>Brand Reputation Score</span>
                                            <span class="badge bg-success rounded-pill">+8%</span>
                                        </li>
                                    </ul>
                                </div>
                                <button class="btn btn-sm btn-outline-primary w-100">View Detailed Analysis</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- How It Works Section -->
    <div class="row mb-5">
        <div class="col-md-10 offset-md-1">
            <div class="card dashboard-card">
                <div class="card-body p-4">
                    <h2 class="card-title mb-4">How It Works: Cross-Domain Predictive Analytics</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-4">
                                <h4><i class="bi bi-database-fill me-2 text-primary"></i> Multi-Domain Data Integration</h4>
                                <p>Our system integrates data from multiple domains:</p>
                                <ul>
                                    <li><strong>Weather forecasts</strong> - historical patterns and future predictions</li>
                                    <li><strong>Economic indicators</strong> - consumer confidence, spending trends, market indices</li>
                                    <li><strong>Transportation metrics</strong> - shipping times, costs, route efficiency, delays</li>
                                    <li><strong>Social media analysis</strong> - consumer sentiment, trend detection, brand perception</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4><i class="bi bi-graph-up-arrow me-2 text-success"></i> Cross-Domain Correlation Engine</h4>
                                <p>Our correlation engine identifies relationships between seemingly unrelated data:</p>
                                <ul>
                                    <li>Detects how weather affects transportation and inventory needs</li>
                                    <li>Identifies relationships between social media sentiment and demand patterns</li>
                                    <li>Maps economic indicators to purchasing behaviors across product categories</li>
                                    <li>Provides confidence scores for all detected correlations</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-4">
                                <h4><i class="bi bi-cpu-fill me-2 text-danger"></i> Predictive ML Models</h4>
                                <p>Our AI-powered predictive models deliver accurate forecasts:</p>
                                <ul>
                                    <li>Uses cross-domain features to enhance prediction accuracy</li>
                                    <li>Applies time-series forecasting with LSTM neural networks</li>
                                    <li>Includes confidence intervals for all predictions</li>
                                    <li>Adapts automatically based on historical accuracy</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4><i class="bi bi-lightning-charge-fill me-2 text-warning"></i> Real-Time Decision Support</h4>
                                <p>The system provides actionable recommendations:</p>
                                <ul>
                                    <li>Suggests specific inventory adjustments with confidence scores</li>
                                    <li>Alerts to potential supply chain disruptions before they occur</li>
                                    <li>Optimizes routes based on cross-domain insights</li>
                                    <li>Provides what-if scenario planning for proactive decision-making</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Key Benefits Section -->
    <div class="row mb-5">
        <div class="col-md-10 offset-md-1">
            <div class="card dashboard-card">
                <div class="card-body p-4">
                    <h2 class="card-title mb-4">Cross-Domain Benefits</h2>
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="d-flex">
                                <div class="flex-shrink-0 text-primary">
                                    <i class="bi bi-check-circle-fill fs-4 me-2"></i>
                                </div>
                                <div>
                                    <h5>Reduce Stockouts by 35%</h5>
                                    <p>Anticipate demand spikes by correlating weather events, social media trends, and economic indicators.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex">
                                <div class="flex-shrink-0 text-primary">
                                    <i class="bi bi-check-circle-fill fs-4 me-2"></i>
                                </div>
                                <div>
                                    <h5>Lower Shipping Costs by 22%</h5>
                                    <p>Optimize transportation routes based on real-time weather conditions and predicted congestion patterns.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex">
                                <div class="flex-shrink-0 text-primary">
                                    <i class="bi bi-check-circle-fill fs-4 me-2"></i>
                                </div>
                                <div>
                                    <h5>Improve Inventory Accuracy by 28%</h5>
                                    <p>Fine-tune order quantities through cross-domain predictive analytics that combine multiple data sources.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex">
                                <div class="flex-shrink-0 text-primary">
                                    <i class="bi bi-check-circle-fill fs-4 me-2"></i>
                                </div>
                                <div>
                                    <h5>Increase Customer Satisfaction by 18%</h5>
                                    <p>Meet delivery expectations consistently through more accurate prediction of logistics challenges.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Call to Action -->
    <div class="row mt-5">
        <div class="col-md-8 offset-md-2 text-center">
            <h2 class="mb-4">Ready to optimize your supply chain with cross-domain analytics?</h2>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <a href="/dashboard" class="btn btn-primary btn-lg px-4 me-sm-3">Explore Dashboard</a>
                <a href="/nlq" class="btn btn-outline-primary btn-lg px-4">Try Natural Language Queries</a>
            </div>
        </div>
    </div>
</div>

<!-- Toast container for notifications -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="dataUpdateToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Data Update</strong>
            <small>Just now</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            Data has been updated successfully.
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Create interactive correlation heatmap
        createCorrelationHeatmap();
        
        // Toggle correlation view between heatmap and table
        const toggleButton = document.getElementById('toggleCorrelationView');
        const heatmapView = document.getElementById('correlationHeatmap');
        const tableView = document.getElementById('correlationTable');
        
        if (toggleButton && heatmapView && tableView) {
            toggleButton.addEventListener('click', function() {
                if (heatmapView.style.display === 'none') {
                    heatmapView.style.display = 'block';
                    tableView.style.display = 'none';
                    toggleButton.innerHTML = '<i class="bi bi-table me-1"></i> Show Table';
                    } else {
                    heatmapView.style.display = 'none';
                    tableView.style.display = 'block';
                    toggleButton.innerHTML = '<i class="bi bi-grid-3x3 me-1"></i> Show Heatmap';
                }
            });
        }
        
        // Time range selector functionality
        const timeRangeSelect = document.getElementById('timeRangeSelect');
        if (timeRangeSelect) {
            timeRangeSelect.addEventListener('change', function() {
                const selectedValue = this.value;
                // Here you would fetch new data based on the selected time range
                console.log('Selected time range:', selectedValue);
                // For demo purposes, let's reload the page with the new time range
                window.location.href = `/use-cases/supply-chain/data?timeRange=${selectedValue}`;
            });
        }
        
        // Initialize tooltips
        if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }
        
        // Function to create the interactive correlation heatmap
        function createCorrelationHeatmap() {
            const heatmapContainer = document.getElementById('correlationHeatmap');
            if (!heatmapContainer || !window.Plotly) {
                console.error('Heatmap container not found or Plotly not loaded');
                return;
            }
            
            // Sample data for the heatmap - in a real app, this would come from the backend
            const domains = ['Weather', 'Economic', 'Transportation', 'Social Media'];
            const correlationMatrix = [
                [1.00, 0.87, 0.63, 0.41],  // Weather correlations
                [0.87, 1.00, 0.76, 0.58],  // Economic correlations
                [0.63, 0.76, 1.00, 0.52],  // Transportation correlations
                [0.41, 0.58, 0.52, 1.00]   // Social Media correlations
            ];
            
            // Create annotations for the heatmap cells
            const annotations = [];
            for (let i = 0; i < domains.length; i++) {
                for (let j = 0; j < domains.length; j++) {
                    annotations.push({
                        x: domains[j],
                        y: domains[i],
                        text: correlationMatrix[i][j].toFixed(2),
                        font: {
                            color: correlationMatrix[i][j] > 0.7 ? 'white' : 'black',
                            size: 12
                        },
                        showarrow: false
                    });
                }
            }
            
            // Configure the heatmap
            const data = [{
                z: correlationMatrix,
                x: domains,
                y: domains,
                type: 'heatmap',
                colorscale: [
                    [0, '#c4463a'],      // Deep red for -1.0
                    [0.25, '#F8696B'],   // Light red for -0.5
                    [0.5, '#F5F5F5'],    // White for 0
                    [0.75, '#63BE7B'],   // Light green for 0.5
                    [1, '#277f2a']       // Deep green for 1.0
                ],
                zmin: 0,
                zmax: 1,
                showscale: true,
                colorbar: {
                    title: 'Correlation',
                    titleside: 'right',
                    titlefont: {
                        size: 14,
                        family: 'Arial, sans-serif'
                    }
                }
            }];
            
            // Layout configuration
            const layout = {
                title: {
                    text: 'Cross-Domain Correlation Matrix',
                    font: {
                        family: 'Arial, sans-serif',
                        size: 18
                    }
                },
                annotations: annotations,
                xaxis: {
                    title: 'Domains',
                    ticks: '',
                    side: 'bottom'
                },
                yaxis: {
                    title: 'Domains',
                    ticks: '',
                    autorange: 'reversed'
                },
                margin: {
                    l: 100,
                    r: 50,
                    b: 100,
                    t: 75,
                    pad: 4
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                hoverlabel: {
                    bgcolor: '#FFF',
                    font: {
                        family: 'Arial, sans-serif'
                    }
                }
            };
            
            // Create the plot
            Plotly.newPlot(heatmapContainer, data, layout, {responsive: true});
            
            // Add click interaction
            heatmapContainer.on('plotly_click', function(data) {
                const point = data.points[0];
                
                // Show a notification with details about the selected correlation
                const domain1 = point.x;
                const domain2 = point.y;
                const correlationValue = point.z;
                
                alert(`Selected correlation: ${domain1} ↔ ${domain2}\nCorrelation value: ${correlationValue.toFixed(2)}`);
                
                // In a real app, this would trigger additional visualizations or details
                console.log(`User clicked on correlation between ${domain1} and ${domain2}`);
            });
        }
    });
</script>
{% endblock %}